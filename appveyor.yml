image: Ubuntu

# environment:
#   APPVEYOR_RDP_PASSWORD:
#     secure: amQ18PhcGpzi95VrjdE94A==

version: reactos.appveyor.{build}
skip_branch_with_pr: true
clone_depth: 5
clone_folder: /home/appveyor/ros_workdir/reactos-cov

init:
#   - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
#
  - sh: cd ~/ros_workdir
  - wget https://svn.reactos.org/amine/RosBEBinFull.tar.gz -O RosBE.tar.gz
  - tar -xzf RosBE.tar.gz
  - echo 'mkdir ../Build && cd ../Build && $APPVEYOR_BUILD_FOLDER/configure.sh && cd reactos && ninja -k0 && ninja bootcd && ninja livecd' > tmp_file
  - sh: cd $APPVEYOR_BUILD_FOLDER

build_script:
  - sh: cd ~/ros_workdir
  - ./RosBEBinFull/RosBE.sh < tmp_file

after_build:
  - sh: export BuildType=gcc
  - sh: export SGVER=$APPVEYOR_BUILD_NUMBER-${APPVEYOR_REPO_COMMIT:0:7}-$BuildType
  - sh: cd ~/ros_workdir/Build/reactos
  - sh: appveyor PushArtifact bootcd.iso -FileName bootcd-$SGVER.iso
  - sh: appveyor PushArtifact livecd.iso -FileName livecd-$SGVER.iso

test: off
deploy: off

# on_finish:
#   - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
