image: Ubuntu

environment:
  BuildVersion: $APPVEYOR_BUILD_NUMBER-${APPVEYOR_REPO_COMMIT:0:7}-gcc

version: Host-Tools.reactos.appveyor.{build}
skip_branch_with_pr: true
clone_depth: 5
clone_folder: ~/ros_workdir/reactos-cov

install:
  - sh: cd ~/ros_workdir
  - sh: wget --no-verbose https://svn.reactos.org/amine/RosBEBinFull.tar.gz
  - sh: chmod u-w RosBEBinFull.tar.gz
  - sh: ll RosBEBinFull.tar.gz
  - sh: tar -xzf RosBEBinFull.tar.gz
  - sh: mkdir Build

build_script:
  - sh: cd Build
  - sh: echo 'cd ../Build && $APPVEYOR_BUILD_FOLDER/configure.sh && cd reactos && ninja -k0 host-tools' > RosBE_build_script_file.txt
  - sh: ../RosBEBinFull/RosBE.sh < RosBE_build_script_file.txt

after_build:
  - sh: cd reactos/host-tools
  - sh: appveyor PushArtifact log2lines -FileName log2lines-$BuildVersion
  - sh: appveyor PushArtifact raddr2line -FileName raddr2line-$BuildVersion

test: off

deploy: off
