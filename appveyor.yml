image: Visual Studio 2019

version: VS2019.wine.appveyor.{build}
skip_branch_with_pr: true
clone_depth: 1
clone_folder: C:\projects\reactos-git_unused

init:
  # - PATH
   # 'C:\Program Files\Git\usr\bin\perl.exe'.
   # 'C:\Strawberry\perl\bin\perl.exe'
  # - where perl
   # '/usr/bin/perl'.
  # - which perl
   # 'This is perl 5, version 26, subversion 2 (v5.26.2) built for x86_64-msys-thread-multi'.
  # - perl -v
   # 'This is perl 5, version 30, subversion 2 (v5.30.2) built for MSWin32-x64-multi-thread'.
  # - C:\Strawberry\perl\bin\perl -v
  - git clone --depth 1 git://source.winehq.org/git/wine.git C:\projects\wine-git

build_script:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvarsall.bat" x86
  - cd C:\projects\wine-git
  - cd include
#   - midl /o urlmon.h /win32 /I. /I..\include /D __WINESRC__ /D _UCRT urlmon.idl
  - midl /win32 /I. /D __WINESRC__ /D _UCRT shtypes.idl
  - midl /win32 /I. /D __WINESRC__ /D _UCRT urlmon.idl
  - midl /win32 /I. /D __WINESRC__ /D _UCRT wtypes.idl
#   - dir urlmon.* wtypes.*
  - cd ..
  - move /Y C:\projects\reactos-git_unused\wine\* tools\winapi\
# Comment utiliser widl pour generer les 2 .h manquants ?
# Et pourquoi utilise-t-il les .h de Wine au lieu de ceux du MS SDK ?
#   - dir include
# BadSyntax  - del dlls\*\tests\generated.c
  - PATH=C:\Strawberry\perl\bin;%PATH%
#   - perl ./tools/winapi/winapi_test --help
  - perl ./tools/winapi/winapi_test --no-progress
#   - perl ./tools/winapi/winapi_test --verbose
   # Vraiment trop (10 MiB, first 1min30s is truncated)
#   - perl ./tools/winapi/winapi_test -d
   # 10 'C:\projects\wine-git\dlls\*\tests'
#   - dir /s "*generated.c*"

test: off
# Comment compiler (seulement) les generated.c? (Pour v√©rifier que corrects.)

before_test:
  - 7z a -mx generated-c.7z  dlls\*\tests\generated.c include\shtypes.h include\urlmon.h include\wtypes.h
#   -FileName ros_tests-%SGVER%.7z
  - appveyor PushArtifact generated-c.7z

test_script:
  - echo NoOp. Only to enable "test_script", thus "before_test".

deploy: off
